<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <link rel="icon" type="image/png" href="/assets/img/favicon.png">
  <link rel="stylesheet" href="/assets/css/material-dashboard.css">
  <link rel="stylesheet" href="/assets/css/material-dashboard.css.map">
  <link rel="stylesheet" href="/assets/css/material-dashboard.min.css">
  <title>
    Category Dashboard
  </title>
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css"
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
  <!-- Nucleo Icons -->
  <link href="/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <!-- CSS Files -->
  <link id="pagestyle" href="/assets/css/material-dashboard.css?v=3.1.0" rel="stylesheet" />
  <!-- Nepcha Analytics (nepcha.com) -->
  <!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->
  <script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
</head>

<body style="overflow: hidden;" class="g-sidenav-show  bg-gray-200">
  <!--header-->
  <%- include('../partials/adminpartials/aside') %>
    <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
      <!-- Navbar -->
      <%- include('../partials/adminpartials/navbar') %>
        <!-- End Navbar -->
        <!--================Checkout Area =================-->
        <section class="checkout_area ">
          <div class="container">
            
            <!-- coupon add modal -->
            <div class="popup" id="popup" style="position: fixed; z-index: 10;">
              <div class="popup-content">
                <span class="close" onclick="closePopup()">&times;</span>
                <h2>Add New Coupon</h2>
                <form id="addressForm" action="/admin/couponadd" class="horizontal-form" method="post">
                  <div class="form-group">
                    <label for="code" class="form-label">Coupon Code:</label>
                    <input type="text" class="form-control" id="code" name="code" required>
                  </div>

                  <div class="form-group">
                    <label for="description" class="form-label">Description:</label>
                    <input type="text" class="form-control" id="description" name="description" required>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Discount Type</label>
                    <select name="discountType" style="border-radius: 10px; padding: 10px;">
                      <option value="Percentage">Percentage</option>
                      <option value="Fixed Amount">Fixed Amount</option>
                    </select>
                  </div>


                  <div class="form-group">
                    <label for="discountvalue" class="form-label">Discount Value:</label>
                    <input type="text" class="form-control" id="discountvalue" name="discountvalue" required>
                  </div>

                  <div class="form-group">
                    <label for="Minimum" class="form-label">Minimum Purchase:</label>
                    <input type="text" class="form-control" id="Minimum" name="Minimum" required>
                  </div>

                  <div class="form-group">
                    <label for="startDate" class="form-label">Start Date:</label>
                    <input type="date" class="form-control" id="startDate" name="startDate" required>
                  </div>

                  <div class="form-group">
                    <label for="endDate" class="form-label"> End Date:</label>
                    <input type="date" class="form-control" id="endDate" name="endDate" required>
                  </div>

                  <button type="submit">Submit</button>
                </form>
              </div>
            </div>

            <!-- coupon edit modal  -->
            <div class="popup" id="editpopup" style="position: fixed; z-index: 10;">
              <div class="popup-content">
                <span class="close" onclick="closeeditPopup()">&times;</span>
                <h2>Add New Coupon</h2>
                <form id="addressForm" action="/admin/couponedit" class="horizontal-form" method="get">
                  <div class="form-group">
                    <label for="code" class="form-label">Coupon Code:</label>
                    <input type="text" value="" class="form-control" id="code" name="code" required>
                  </div>
                  <div class="form-group">
                    <label for="description" class="form-label">Description:</label>
                    <input type="text" value=""  class="form-control" id="description" name="description" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Discount Type</label>
                    <select name="discountType" style="border-radius: 10px; padding: 10px;">
                      <option value="Percentage">Percentage</option>
                      <option value="Fixed Amount">Fixed Amount</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="discountvalue"  class="form-label">Discount Value:</label>
                    <input type="text"value=""  class="form-control" id="discountvalue" name="discountvalue" required>
                  </div>
                  <div class="form-group">
                    <label for="Minimum" class="form-label">Minimum Purchase:</label>
                    <input type="text" value=""  class="form-control" id="Minimum" name="Minimum" required>
                  </div>
                  <div class="form-group">
                    <label for="startDate" class="form-label">Start Date:</label>
                    <input type="date " value=""  class="form-control" id="startDate" name="startDate" required>
                  </div>
                  <div class="form-group">
                    <label for="endDate" class="form-label"> End Date:</label>
                    <input type="date" value=""  class="form-control" id="endDate" name="endDate" required>
                  </div>
                  <button type="submit">Submit</button>
                </form>
              </div>
            </div>


            <div class="row mb-4">
              <div class="col-12 grid-margin">
                <div class="card">
                  <div class="card-body" style="overflow: hidden;">
                    <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
                      <div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
                        <h6 class="text-white text-capitalize ps-3">Coupon Management</h6>
                     
                      </div>
                      <% if (errorMessage) { %>
                        <h1 style="color: red;">
                          <%= errorMessage %>
                        </h1>
                        <% } %>
                      <div class="col-12 mt-3">
                        <button class="btn btn-primary btn-block .addcategory" onclick="openPopup()">ADD New
                          Coupon</button>


                      </div>
                    </div>
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Code</th>
                            <th> Type</th>
                            <th> Value</th>
                            <th>minimum</th>
                            <th> Date</th>

                            <th> Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <%coupondata.forEach((row,index)=> {%>

                            <tr>
                              <td style="padding-left: 15px;">
                                <%= row.code %>
                              </td>
                              <td>
                                <%= row.discountType%>
                              </td>
                              <td>
                                <%= row.discountValue %>
                              </td>
                              <td>
                                <%= row.minimumPurchase %>
                              </td>

                              <td>
                                <% let startDate=new Date(row.startDate); let endDate=new Date(row.endDate); let
                                  formattedStartDate=`${startDate.getDate().toString().padStart(2, '0'
                                  )}-${(startDate.getMonth() + 1).toString().padStart(2, '0'
                                  )}-${startDate.getFullYear()}`; let
                                  formattedEndDate=`${endDate.getDate().toString().padStart(2, '0'
                                  )}-${(endDate.getMonth() + 1).toString().padStart(2, '0' )}-${endDate.getFullYear()}`;
                                  %>

                                  <%= formattedStartDate %> to <%= formattedEndDate %>
                              </td>


                              <td><button onclick="confirmedit('<%= row.id %>')"
                                  class="btn btn-success dltBtn">Edit</button>

                                <button class="btn btn-danger dltBtn"
                                  onclick="confirmDelete('<%= row.id %>')">Delete</button>


                              </td>
                              <td>

                              </td>
                            </tr>

                            </tr>
                        </tbody>
                        <%}); %>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <%- include('../partials/adminpartials/footer') %>
          </div>
    </main>

</body>
<!-- Include SweetAlert library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<style>
  body {
    font-family: Arial, sans-serif;
  }

  .popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100dvw;
    height: 100dvh;
    background-color: rgba(0, 0, 0, 0.5);
  }

  .popup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgb(235, 229, 229);
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  }

  .close {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 40px;
    cursor: pointer;
  }

  .horizontal-form {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-label {
    margin-bottom: 5px;
  }

  .form-control {
    padding: 8px;
    margin-bottom: 10px;
  }

  button {
    grid-column: span 2;
    /* Make the button span two columns */
    padding: 10px;
    background-color: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 0;
    /* Reset default body margin */
  }

  .btn_3 {
    padding: 10px;
    background-color: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin: 20px 0;
    /* Add margin top and bottom */
  }

  /* Responsive margin adjustments */
  @media screen and (max-width: 600px) {
    .btn_1 {
      margin: 10px 0;
      /* Adjust margin for smaller screens */
    }
  }
</style>
<script>
  function openPopup() {
    document.getElementById('popup').style.display = 'block';
  }
  function closePopup() {
    document.getElementById('popup').style.display = 'none';
  } 
</script>


<script>
  function confirmDelete(id) {
    Swal.fire({
      title: 'Are you sure?',
      text: 'You won\'t be able to revert this!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        fetch(`/admin/coupondelete/${id}`, {
          method: 'POST',
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            console.log(data);
            Swal.fire('Deleted!', 'Your coupon has been deleted.', 'success');
            window.location.reload();
          })
          .catch(error => {
            console.error('Fetch error:', error);
            Swal.fire('Error!', 'An error occurred while deleting the coupon.', 'error');
          });
      }
    });
  }
</script>


<script>

    function confirmedit(couponId) {
      // Fetch the coupon details using the couponId
      fetch(`/admin/getCouponDetails/${couponId}`)
        .then(response => response.json())
        .then(data => {
          // Check if the elements are found
          console.log(document.getElementById('code'));

          // Update the modal fields with the fetched data
          document.getElementById('code').value = data.code;
          document.getElementById('description').value = data.description;
          document.getElementById('discountType').value = data.discountType;
          document.getElementById('discountvalue').value = data.discountValue;
          document.getElementById('Minimum').value = data.minimumPurchase;
          document.getElementById('startDate').value = data.startDate;
          document.getElementById('endDate').value = data.endDate;

          // Show the edit modal
          document.getElementById('editpopup').style.display = 'block';
        })
        .catch(error => console.error('Fetch error:', error));
    }

    function closeeditPopup() {
      document.getElementById('editpopup').style.display = 'none';
    }

</script>



<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>




</html>